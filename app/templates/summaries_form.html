{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">{{ 'Edit' if item else 'Add' }} Monthly Summary</h1>

<div class="card mb-4">
  <form method="post" class="grid grid-cols-1 md:grid-cols-6 gap-3" oninput="updateTotal()">
    <div>
      <label class="text-sm text-slate-500">Year</label>
      <select name="year" class="input" required>
        {% for y in range(2022, 2036) %}
        <option value="{{ y }}" {% if item and item.year==y %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="text-sm text-slate-500">Month</label>
      <select name="month" class="input" required>
        {% for m in range(1,13) %}
        <option value="{{ m }}" {% if item and item.month==m %}selected{% endif %}>{{ "%02d"|format(m) }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="md:col-span-4 flex items-end">
      <div class="text-sm text-slate-500">
        Period auto: First/last day of selected month.
      </div>
    </div>

    <div>
      <label class="text-sm text-slate-500">Chakravarthy Lodge</label>
      <input name="lodge_chakravarthy" type="number" step="0.01" class="input" value="{{ item.lodge_chakravarthy if item else '' }}">
    </div>
    <div>
      <label class="text-sm text-slate-500">Monthly Tenants</label>
      <input name="monthly_rent_building" type="number" step="0.01" class="input" value="{{ item.monthly_rent_building if item else '' }}">
    </div>
    <div>
      <label class="text-sm text-slate-500">Relax Inn Lodge</label>
      <input name="lodge_relax_inn" type="number" step="0.01" class="input" value="{{ item.lodge_relax_inn if item else '' }}">
    </div>
    <div>
      <label class="text-sm text-slate-500">Misc Income</label>
      <input name="misc_income" type="number" step="0.01" class="input" value="{{ item.misc_income if item else '' }}">
    </div>
    <div class="md:col-span-3">
      <label class="text-sm text-slate-500">Notes</label>
      <input name="notes" class="input" value="{{ item.notes if item else '' }}">
    </div>
    <div class="md:col-span-3">
      <label class="text-sm text-slate-500">Grand Total</label>
      <input id="total_income" class="input bg-slate-100" readonly value="{{ '%.2f'|format(item.total_income) if item and item.total_income is not none else '' }}">
    </div>

    <div class="md:col-span-6">
      <button class="btn">{{ 'Update' if item else 'Add' }}</button>
      <a href="{{ url_for('summaries.list_summaries') }}" class="btn-outline ml-2">Cancel</a>
    </div>
  </form>
</div>

<script>
function valOr0(name) {
  const el = document.querySelector(`[name="${name}"]`);
  return el && el.value ? parseFloat(el.value) : 0;
}
function updateTotal() {
  const total =
    valOr0('lodge_chakravarthy') +
    valOr0('monthly_rent_building') +
    valOr0('lodge_relax_inn') +
    valOr0('misc_income');
  const out = document.getElementById('total_income');
  if (out) out.value = total.toFixed(2);
}
updateTotal();
</script>
{% endblock %}
